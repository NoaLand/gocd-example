{
  "format_version": 2,
  "pipelines": [
    {
      "name": "Codebase",
      "group": "Combination-Pipelines-Example",
      "materials": {
        "git": {
          "url": "https://github.com/NoaLand/good-example.git",
          "branch": "main"
        }
      },
      "stages": [
        {
          "name": "CheckoutCode",
          "jobs": [
            {
              "name": "CheckoutJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Checked out code"]
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Publisher1",
      "group": "Combination-Pipelines-Example",
      "materials": {
        "pipeline": {
          "pipeline_name": "Codebase",
          "stage": "CheckoutCode",
          "auto_update": true
        }
      },
      "stages": [
        {
          "name": "Build",
          "jobs": [
            {
              "name": "BuildJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Publisher1 build"]
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "StaticCheck",
          "jobs": [
            {
              "name": "StaticCheckJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Publisher1 static check"]
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "UnitTest",
          "jobs": [
            {
              "name": "UnitTestJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Publisher1 unit test"]
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "IntegrationTest",
          "jobs": [
            {
              "name": "IntegrationTestJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Publisher1 integration test"]
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Subscriber1",
      "group": "Combination-Pipelines-Example",
      "materials": {
        "pipeline": {
          "pipeline_name": "Codebase",
          "stage": "CheckoutCode",
          "auto_update": true
        }
      },
      "stages": [
        {
          "name": "Build",
          "jobs": [
            {
              "name": "BuildJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Subscriber1 build"]
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "StaticCheck",
          "jobs": [
            {
              "name": "StaticCheckJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Subscriber1 static check"]
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "UnitTest",
          "jobs": [
            {
              "name": "UnitTestJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Subscriber1 unit test"]
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "IntegrationTest",
          "jobs": [
            {
              "name": "IntegrationTestJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Subscriber1 integration test"]
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Publisher2",
      "group": "Combination-Pipelines-Example",
      "materials": {
        "pipeline": {
          "pipeline_name": "Codebase",
          "stage": "CheckoutCode",
          "auto_update": true
        }
      },
      "stages": [
        {
          "name": "Build",
          "jobs": [
            {
              "name": "BuildJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Publisher2 build"]
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "StaticCheck",
          "jobs": [
            {
              "name": "StaticCheckJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Publisher2 static check"]
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "UnitTest",
          "jobs": [
            {
              "name": "UnitTestJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Publisher2 unit test"]
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "IntegrationTest",
          "jobs": [
            {
              "name": "IntegrationTestJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Publisher2 integration test"]
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "System Integration Test for A",
      "group": "Combination-Pipelines-Example",
      "materials": {
        "pipeline_materials": [
          {
            "pipeline_name": "Publisher1",
            "stage": "IntegrationTest",
            "auto_update": true
          },
          {
            "pipeline_name": "Subscriber1",
            "stage": "IntegrationTest",
            "auto_update": true
          }
        ]
      },
      "stages": [
        {
          "name": "to Test Env",
          "jobs": [
            {
              "name": "DeployToTestJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Deploy SIT to Test Env"]
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "Run SIT",
          "jobs": [
            {
              "name": "SITJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Running System Integration Test for A"]
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "to Staging",
      "group": "Combination-Pipelines-Example",
      "materials": {
        "pipeline_materials": [
          {
            "pipeline_name": "System Integration Test for A",
            "stage": "Run SIT",
            "auto_update": true
          },
          {
            "pipeline_name": "Publisher2",
            "stage": "IntegrationTest",
            "auto_update": true
          }
        ]
      },
      "stages": [
        {
          "name": "ManualApproval",
          "jobs": [
            {
              "name": "ApprovalJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Waiting for manual trigger to Staging"]
                  }
                }
              ]
            }
          ]
        },
        {
          "name": "DeployToStaging",
          "jobs": [
            {
              "name": "DeployJob",
              "tasks": [
                {
                  "exec": {
                    "command": "echo",
                    "arguments": ["Deploying to Staging"]
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
